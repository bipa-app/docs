---
title: "Create Trade"
description: "Execute a direct trade at the current market rate."
api: "POST https://api.bipa.app/v1/trades"
---

## Request

Create a trade that executes at the current market rate. For guaranteed rates, use the [Quotes API](/api-reference/quotes/overview) instead.

### Body parameters

<ParamField body="customer_id" type="string" required>
  Customer executing the trade
</ParamField>

<ParamField body="pair" type="string" required>
  Trading pair: `BRL-USDT`, `USDT-BRL`, `BRL-BTC`, `BTC-BRL`, `USDT-BTC`, `BTC-USDT`
</ParamField>

<ParamField body="side" type="string" required>
  Trade side: `buy` or `sell`
  - `buy`: Buy the base currency (first in pair)
  - `sell`: Sell the base currency
</ParamField>

<ParamField body="amount_cents" type="integer">
  Amount in BRL cents. Required when BRL is involved.
</ParamField>

<ParamField body="amount" type="string">
  Amount in crypto. Required for crypto-to-crypto pairs.
</ParamField>

<ParamField body="idempotency_key" type="string" required>
  Unique key to prevent duplicate trades
</ParamField>

### Understanding side

For pair `BRL-USDT`:
- `buy`: Spend BRL to get USDT
- `sell`: Spend USDT to get BRL

For pair `BTC-USDT`:
- `buy`: Spend USDT to get BTC
- `sell`: Spend BTC to get USDT

## Response

<ResponseField name="id" type="string">
  Unique trade identifier
</ResponseField>

<ResponseField name="customer_id" type="string">
  Customer who executed the trade
</ResponseField>

<ResponseField name="pair" type="string">
  Trading pair
</ResponseField>

<ResponseField name="side" type="string">
  Trade side
</ResponseField>

<ResponseField name="status" type="string">
  Trade status
</ResponseField>

<ResponseField name="from_currency" type="string">
  Currency debited
</ResponseField>

<ResponseField name="to_currency" type="string">
  Currency credited
</ResponseField>

<ResponseField name="from_amount_cents" type="integer">
  Amount debited (cents for BRL)
</ResponseField>

<ResponseField name="to_amount" type="string">
  Amount credited
</ResponseField>

<ResponseField name="executed_rate" type="string">
  Execution rate
</ResponseField>

<ResponseField name="fee_cents" type="integer">
  Fee in BRL cents
</ResponseField>

<ResponseField name="idempotency_key" type="string">
  Your idempotency key
</ResponseField>

<ResponseField name="created_at" type="string">
  ISO 8601 timestamp
</ResponseField>

<ResponseField name="completed_at" type="string">
  ISO 8601 timestamp
</ResponseField>

<RequestExample>
```bash cURL - Buy USDT with BRL
curl -X POST https://api.bipa.app/v1/trades \
  -H "Authorization: Bearer sk_live_..." \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": "cus_a1b2c3d4e5f6",
    "pair": "BRL-USDT",
    "side": "buy",
    "amount_cents": 100000,
    "idempotency_key": "trade_order_12345"
  }'
```

```bash cURL - Sell BTC for BRL
curl -X POST https://api.bipa.app/v1/trades \
  -H "Authorization: Bearer sk_live_..." \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": "cus_a1b2c3d4e5f6",
    "pair": "BTC-BRL",
    "side": "sell",
    "amount": "0.001",
    "idempotency_key": "trade_btc_sell_789"
  }'
```

```python Python
import requests
import uuid

# Buy USDT with R$ 1,000
response = requests.post(
    "https://api.bipa.app/v1/trades",
    headers={
        "Authorization": "Bearer sk_live_...",
        "Content-Type": "application/json"
    },
    json={
        "customer_id": "cus_a1b2c3d4e5f6",
        "pair": "BRL-USDT",
        "side": "buy",
        "amount_cents": 100000,  # R$ 1,000.00
        "idempotency_key": f"trade_{uuid.uuid4()}"
    }
)

trade = response.json()
print(f"Bought {trade['to_amount']} USDT at rate {trade['executed_rate']}")
```

```javascript Node.js
import { randomUUID } from "crypto";

// Buy USDT with R$ 1,000
const response = await fetch("https://api.bipa.app/v1/trades", {
  method: "POST",
  headers: {
    "Authorization": "Bearer sk_live_...",
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    customer_id: "cus_a1b2c3d4e5f6",
    pair: "BRL-USDT",
    side: "buy",
    amount_cents: 100000, // R$ 1,000.00
    idempotency_key: `trade_${randomUUID()}`
  })
});

const trade = await response.json();
console.log(`Bought ${trade.to_amount} USDT at rate ${trade.executed_rate}`);
```
</RequestExample>

<ResponseExample>
```json 201 Created
{
  "id": "trd_abc123xyz",
  "customer_id": "cus_a1b2c3d4e5f6",
  "pair": "BRL-USDT",
  "side": "buy",
  "status": "completed",
  "from_currency": "BRL",
  "to_currency": "USDT",
  "from_amount_cents": 100000,
  "to_amount": "163.12",
  "executed_rate": "6.1305",
  "fee_cents": 500,
  "fee_currency": "BRL",
  "idempotency_key": "trade_order_12345",
  "created_at": "2024-01-15T10:30:00Z",
  "completed_at": "2024-01-15T10:30:01Z"
}
```

```json 400 Insufficient Balance
{
  "error": {
    "type": "invalid_request_error",
    "code": "insufficient_balance",
    "message": "Customer does not have sufficient BRL balance",
    "param": "amount_cents"
  }
}
```

```json 400 Invalid Pair
{
  "error": {
    "type": "invalid_request_error",
    "code": "invalid_currency_pair",
    "message": "Trading pair BRL-ETH is not supported",
    "param": "pair"
  }
}
```

```json 409 Duplicate Trade
{
  "error": {
    "type": "invalid_request_error",
    "code": "duplicate_idempotency_key",
    "message": "A trade with this idempotency key already exists"
  }
}
```
</ResponseExample>

## Dollar-Cost Averaging (DCA) Example

Set up recurring trades for DCA:

```python
import schedule
import time

def daily_btc_purchase(customer_id: str, amount_cents: int):
    """Execute a daily BTC purchase."""
    trade = requests.post(
        "https://api.bipa.app/v1/trades",
        headers={
            "Authorization": "Bearer sk_live_...",
            "Content-Type": "application/json"
        },
        json={
            "customer_id": customer_id,
            "pair": "BRL-BTC",
            "side": "buy",
            "amount_cents": amount_cents,
            "idempotency_key": f"dca_{customer_id}_{datetime.now().date()}"
        }
    ).json()

    print(f"DCA executed: Bought {trade['to_amount']} BTC")

# Schedule daily at 9 AM
schedule.every().day.at("09:00").do(
    daily_btc_purchase,
    customer_id="cus_abc123",
    amount_cents=10000  # R$ 100/day
)
```

<Note>
  Use date-based idempotency keys to ensure only one DCA trade per day per customer.
</Note>

