---
title: "Pay Invoice"
description: "Pay a Lightning invoice."
api: "POST https://api.bipa.app/v1/lightning/payments"
---

## Request

Pay a Lightning invoice from a customer's BTC balance.

### Body parameters

<ParamField body="customer_id" type="string" required>
  Customer sending the payment
</ParamField>

<ParamField body="payment_request" type="string" required>
  BOLT11 invoice string to pay
</ParamField>

<ParamField body="max_fee_sats" type="integer" default="1000">
  Maximum routing fee in satoshis. Payment fails if fee exceeds this.
</ParamField>

<ParamField body="idempotency_key" type="string" required>
  Unique key to prevent duplicate payments
</ParamField>

<Warning>
  The customer must have sufficient BTC balance. The amount plus routing fees will be deducted.
</Warning>

## Response

<ResponseField name="id" type="string">
  Unique payment identifier
</ResponseField>

<ResponseField name="customer_id" type="string">
  Customer who sent the payment
</ResponseField>

<ResponseField name="payment_hash" type="string">
  Payment hash from the invoice
</ResponseField>

<ResponseField name="payment_preimage" type="string">
  Proof of payment (available when completed)
</ResponseField>

<ResponseField name="amount_sats" type="integer">
  Amount paid in satoshis
</ResponseField>

<ResponseField name="fee_sats" type="integer">
  Routing fee paid
</ResponseField>

<ResponseField name="status" type="string">
  `pending`, `completed`, or `failed`
</ResponseField>

<ResponseField name="payment_request" type="string">
  The original invoice
</ResponseField>

<ResponseField name="failure_reason" type="string">
  Error details if failed
</ResponseField>

<ResponseField name="idempotency_key" type="string">
  Your idempotency key
</ResponseField>

<ResponseField name="created_at" type="string">
  ISO 8601 timestamp
</ResponseField>

<ResponseField name="completed_at" type="string">
  ISO 8601 timestamp
</ResponseField>

<RequestExample>
```bash cURL
curl -X POST https://api.bipa.app/v1/lightning/payments \
  -H "Authorization: Bearer sk_live_..." \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": "cus_a1b2c3d4e5f6",
    "payment_request": "lnbc1m1pj...",
    "max_fee_sats": 100,
    "idempotency_key": "ln_pay_789"
  }'
```

```python Python
import requests
import uuid

response = requests.post(
    "https://api.bipa.app/v1/lightning/payments",
    headers={
        "Authorization": "Bearer sk_live_...",
        "Content-Type": "application/json"
    },
    json={
        "customer_id": "cus_a1b2c3d4e5f6",
        "payment_request": "lnbc1m1pjx4q5dpp5...",
        "max_fee_sats": 100,
        "idempotency_key": f"ln_{uuid.uuid4()}"
    }
)

payment = response.json()

if payment["status"] == "completed":
    print(f"Payment successful!")
    print(f"Amount: {payment['amount_sats']} sats")
    print(f"Fee: {payment['fee_sats']} sats")
    print(f"Preimage: {payment['payment_preimage']}")
else:
    print(f"Payment failed: {payment.get('failure_reason')}")
```

```javascript Node.js
import { randomUUID } from "crypto";

const response = await fetch(
  "https://api.bipa.app/v1/lightning/payments",
  {
    method: "POST",
    headers: {
      "Authorization": "Bearer sk_live_...",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      customer_id: "cus_a1b2c3d4e5f6",
      payment_request: "lnbc1m1pjx4q5dpp5...",
      max_fee_sats: 100,
      idempotency_key: `ln_${randomUUID()}`
    })
  }
);

const payment = await response.json();

if (payment.status === "completed") {
  console.log(`Payment successful! Fee: ${payment.fee_sats} sats`);
} else {
  console.log(`Payment failed: ${payment.failure_reason}`);
}
```
</RequestExample>

<ResponseExample>
```json 201 Created - Success
{
  "id": "ln_pay_xyz789",
  "customer_id": "cus_a1b2c3d4e5f6",
  "payment_hash": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234abcd",
  "payment_preimage": "f6e5d4c3b2a1098765432109876543210987654321098765432109876543dcba",
  "amount_sats": 100000,
  "fee_sats": 10,
  "status": "completed",
  "payment_request": "lnbc1m1pj...",
  "idempotency_key": "ln_pay_789",
  "created_at": "2024-01-15T10:30:00Z",
  "completed_at": "2024-01-15T10:30:01Z"
}
```

```json 400 Insufficient Balance
{
  "error": {
    "type": "invalid_request_error",
    "code": "insufficient_balance",
    "message": "Customer does not have sufficient BTC balance",
    "param": "customer_id"
  }
}
```

```json 400 Invalid Invoice
{
  "error": {
    "type": "invalid_request_error",
    "code": "invalid_payment_request",
    "message": "The payment request is invalid or expired",
    "param": "payment_request"
  }
}
```

```json 201 Created - Failed
{
  "id": "ln_pay_failed123",
  "customer_id": "cus_a1b2c3d4e5f6",
  "payment_hash": "...",
  "amount_sats": 100000,
  "status": "failed",
  "failure_reason": "No route found to destination",
  "payment_request": "lnbc1m1pj...",
  "created_at": "2024-01-15T10:30:00Z"
}
```
</ResponseExample>

## Failure reasons

| Reason | Description | Action |
|--------|-------------|--------|
| `no_route` | No payment route found | Try again later or use smaller amount |
| `timeout` | Payment timed out | Retry the payment |
| `insufficient_balance` | Not enough BTC | Fund the account |
| `invoice_expired` | Invoice has expired | Request a new invoice |
| `fee_exceeded` | Routing fee exceeds `max_fee_sats` | Increase fee limit or try later |

<Note>
  Lightning payments can fail due to network routing issues. Always check the status and handle failures gracefully.
</Note>

## Proof of payment

The `payment_preimage` is cryptographic proof that the payment was made. Store it for dispute resolution:

```python
def process_lightning_payment(invoice: str, customer_id: str):
    payment = pay_invoice(customer_id, invoice)

    if payment["status"] == "completed":
        # Store proof of payment
        save_payment_proof(
            invoice=invoice,
            preimage=payment["payment_preimage"],
            timestamp=payment["completed_at"]
        )
        return True

    return False
```

